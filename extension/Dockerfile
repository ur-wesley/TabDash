FROM node:alpine

WORKDIR /usr/src/tabdash/extension

COPY package.json ./

ARG VITE_COMPANION_BASE
ARG VITE_BACKEND_BASE
ARG VITE_IS_EXTENSION
ARG VITE_OPENWEATHER_API_KEY
ARG VITE_UNSPLASH_API_KEY

ENV VITE_COMPANION_BASE VITE_COMPANION_BASE
ENV VITE_BACKEND_BASE VITE_BACKEND_BASE
ENV VITE_IS_EXTENSION VITE_IS_EXTENSION
ENV VITE_OPENWEATHER_API_KEY VITE_OPENWEATHER_API_KEY
ENV VITE_UNSPLASH_API_KEY VITE_UNSPLASH_API_KEY

RUN npm install

COPY . .

RUN npm run build

EXPOSE 3003

CMD [ "npm", "run", "serve" ]